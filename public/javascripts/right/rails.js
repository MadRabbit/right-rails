/**
 * The Ruby On Rails plugin for RightJS
 * http://github.com/MadRabbit/right-rails
 *
 * Copyright (C) 2009-2010 Nikolay Nemshilov
 */
(function(j,k,e){var g=e.$,l={Options:{format:"js",flashId:"flashes",flashHideFx:"slide",flashHideDelay:3200,highlightUpdates:true,removeFx:"fade",insertFx:"fade",insertPosition:"bottom",linkToAjaxEdit:".ajax_edit",linkToAjaxDelete:".ajax_delete",rescanWithScopes:true},update_flash:function(a){var b=g(this.Options.flashId);b&&this.replace(b,a).hide_flash();return this},hide_flash:function(){if(this.Options.flashHideDelay>-1){var a=g(this.Options.flashId);a&&a.visible()&&a.hide.bind(a,this.Options.flashHideFx).delay(this.Options.flashHideDelay)}return this},
highlight:function(a){g(a)&&this.Options.highlightUpdates&&g(a).highlight();return this},insert:function(a,b,f){f=f||this.Options.insertPosition;var c;b=g(a).insert(b,f);switch(f){case "bottom":c=b.children().last();break;case "top":c=b.first();break;case "before":c=b.prev();break;case "after":c=b.next();break}c&&this.Options.insertFx?c.hide().show(this.Options.insertFx,{onFinish:this.highlight.bind(this,c)}):this.highlight(c);return this.rescan(a)},replace:function(a,b){g(a).replace(b);return this.highlight(a).rescan(a)},
remove:function(a){g(a)&&g(a).remove(this.Options.removeFx,{onFinish:remove_element})},remotize_form:function(a){if(a=g(a))a.remotize().enable()._.action+="."+this.Options.format;return this},replace_form:function(a,b){var f=g(a);if(f){f.replace(b);this.remotize_form(a)}return this.rescan(a)},show_form_for:function(a,b){g(a).select("form").each("remove");g(a).insert(b);return this.remotize_form(g(a).first("form")).rescan(a)},process_click:function(a){var b=a.target;if(b=[b].concat(b.parents()).first("match",
"a"))if(b.match(this.Options.linkToAjaxEdit)){a.stop();Xhr.load(b.href+"."+this.Options.format)}else if(b.match(this.Options.linkToAjaxDelete)&&b.has("onclick")){a.stop();eval("({f:"+b.onclick.toString().replace(".submit",".send")+"})").f.call(b)}},rescan:function(a){$w("Draggable Droppable Tabs Slider Selectable").each(function(b){if(b in j)j[b].rescan(this.Options.rescanWithScopes?a:null)},this);return this}};(function(){var a=function(c,d){var i=d.get("data-confirm");if(i&&!confirm(i)){c.stop();
return true}},b=function(c,d){return Object.merge({onCreate:function(){c.fire("ajax:loading",this)},onComplete:function(){c.fire("ajax:complete",this)},onSuccess:function(){c.fire("ajax:success",this)},onFailure:function(){c.fire("ajax:failure",this)}},d)},f=function(c,d){if(!a(c,d)&&g(d.form).has("data-remote")){c.stop();d.form.send(b(d.form))}};g(k).on({click:function(c){var d=c.target,i=d.form,h=[d].concat(d.parents()).first("match","a");if(i&&["submit","image"].include(d.type))f(c,d);else if(h){d=
h.get("data-method");i=h.get("data-remote");if(!a(c,h)){if(d||i)c.stop();if(i)Xhr.load(h.href,b(h,{method:d||"get",spinner:h.get("data-spinner")}));else if(d){c=$$("meta[name=csrf-param]")[0];i=$$("meta[name=csrf-token]")[0];h=$E("form",{action:h.href,method:"post"});c&&i&&h.insert('<input type="hidden" name="'+c.get("content")+'" value="'+i.get("content")+'" />');h.insert('<input type="hidden" name="_method" value="'+d+'"/>').insertTo(k.body).submit()}}}},keydown:function(c){var d=c.target;d.form&&
d.tagName==="INPUT"&&c.keyCode==13&&f(c,d)}})})();g(k).on({ready:function(){l.hide_flash()},click:function(a){l.process_click(a)}});e([e.String.prototype,e.Array.prototype,e.Function.prototype,e.Object,e.Options,e.Observer,e.Observer.prototype,j,k]).each(function(a){for(var b in a)try{if(/[A-Z]/.test(b)&&typeof a[b]==="function"){var f=e(b).underscored();if(a[f]===null||a[f]===undefined)a[f]=a[b]}}catch(c){}});e([e.Element,e.Event,e.Form,e.Input]).each(function(a){if(a){var b=a.prototype;for(var f in b)if(/[A-Z]/.test(f)&&
typeof b[f]==="function")a.prototype[e(f).underscored()]=b[f]}});e.$alias(e.String.prototype,{index_of:"indexOf",last_index_of:"lastIndexOf",to_f:"toFloat",to_i:"toInt",gsub:"replace",downcase:"toLowerCase",upcase:"toUpperCase",index:"indexOf",rindex:"lastIndexOf",strip:"trim"});e.$alias(e.Array.prototype,{collect:"map",detect:"filter",index_of:"indexOf",last_index_of:"lastIndexOf",index:"indexOf",rindex:"lastIndexOf"});j.RR=l})(window,document,RightJS);
